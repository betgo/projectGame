{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "game-project.schema.json",
  "title": "GameProject",
  "oneOf": [
    { "$ref": "#/$defs/towerDefenseProject" },
    { "$ref": "#/$defs/rpgTopdownProject" }
  ],
  "$defs": {
    "meta": {
      "type": "object",
      "required": ["name", "version"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "version": {
          "type": "string",
          "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)$"
        }
      },
      "additionalProperties": false
    },
    "towerDefenseMap": {
      "type": "object",
      "required": ["width", "height", "cells"],
      "properties": {
        "width": { "type": "integer", "minimum": 4 },
        "height": { "type": "integer", "minimum": 4 },
        "cells": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "integer", "minimum": 0, "maximum": 2 }
          }
        }
      },
      "additionalProperties": false
    },
    "rpgTopdownMap": {
      "type": "object",
      "required": ["width", "height", "cells"],
      "properties": {
        "width": { "type": "integer", "minimum": 4 },
        "height": { "type": "integer", "minimum": 4 },
        "cells": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "integer", "minimum": 0, "maximum": 3 }
          }
        }
      },
      "additionalProperties": false
    },
    "towerDefenseProject": {
      "type": "object",
      "required": ["meta", "templateId", "map", "templatePayload", "editorState"],
      "properties": {
        "meta": { "$ref": "#/$defs/meta" },
        "templateId": { "type": "string", "const": "tower-defense" },
        "map": { "$ref": "#/$defs/towerDefenseMap" },
        "templatePayload": { "$ref": "tower-defense.schema.json" },
        "editorState": {
          "type": "object",
          "required": ["selectedTool", "speed"],
          "properties": {
            "selectedTool": { "type": "string", "enum": ["empty", "path", "tower"] },
            "speed": { "type": "number", "minimum": 0.5, "maximum": 8 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "rpgTopdownProject": {
      "type": "object",
      "required": ["meta", "templateId", "map", "templatePayload", "editorState"],
      "properties": {
        "meta": { "$ref": "#/$defs/meta" },
        "templateId": { "type": "string", "const": "rpg-topdown" },
        "map": { "$ref": "#/$defs/rpgTopdownMap" },
        "templatePayload": { "$ref": "rpg-topdown.schema.json" },
        "editorState": {
          "type": "object",
          "required": ["selectedTool", "speed"],
          "properties": {
            "selectedTool": { "type": "string", "enum": ["terrain", "spawn", "entity"] },
            "speed": { "type": "number", "minimum": 0.5, "maximum": 8 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}
